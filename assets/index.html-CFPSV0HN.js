import{_ as e,c,a,b as t,d as p,w as i,r as h,o as k,e as l}from"./app-BVpc6fz1.js";const d={},r={class:"table-of-contents"};function y(A,s){const n=h("router-link");return k(),c("div",null,[a("nav",r,[a("ul",null,[a("li",null,[p(n,{to:"#简介"},{default:i(()=>s[0]||(s[0]=[l("简介")])),_:1}),a("ul",null,[a("li",null,[p(n,{to:"#与-ad-hoc-的区别"},{default:i(()=>s[1]||(s[1]=[l("与 ad-hoc 的区别")])),_:1})])])]),a("li",null,[p(n,{to:"#核心元素"},{default:i(()=>s[2]||(s[2]=[l("核心元素")])),_:1})]),a("li",null,[p(n,{to:"#基本语法"},{default:i(()=>s[3]||(s[3]=[l("基本语法")])),_:1}),a("ul",null,[a("li",null,[p(n,{to:"#yaml-规则"},{default:i(()=>s[4]||(s[4]=[l("YAML 规则")])),_:1})])])]),a("li",null,[p(n,{to:"#使用示例"},{default:i(()=>s[5]||(s[5]=[l("使用示例")])),_:1}),a("ul",null,[a("li",null,[p(n,{to:"#_1-基本示例"},{default:i(()=>s[6]||(s[6]=[l("1. 基本示例")])),_:1})])])]),a("li",null,[p(n,{to:"#playbook的运行方式"},{default:i(()=>s[7]||(s[7]=[l("Playbook的运行方式")])),_:1}),a("ul",null,[a("li",null,[p(n,{to:"#基本用法"},{default:i(()=>s[8]||(s[8]=[l("基本用法")])),_:1})]),a("li",null,[p(n,{to:"#常用选项"},{default:i(()=>s[9]||(s[9]=[l("常用选项")])),_:1})]),a("li",null,[p(n,{to:"#执行示例"},{default:i(()=>s[10]||(s[10]=[l("执行示例")])),_:1})])])]),a("li",null,[p(n,{to:"#playbook中元素属性"},{default:i(()=>s[11]||(s[11]=[l("Playbook中元素属性")])),_:1}),a("ul",null,[a("li",null,[p(n,{to:"#_1-主机与用户-hosts-users"},{default:i(()=>s[12]||(s[12]=[l("1. 主机与用户(Hosts & Users)")])),_:1})]),a("li",null,[p(n,{to:"#_2-任务列表-tasks"},{default:i(()=>s[13]||(s[13]=[l("2. 任务列表(Tasks)")])),_:1})]),a("li",null,[p(n,{to:"#_3-处理器-handlers"},{default:i(()=>s[14]||(s[14]=[l("3. 处理器(Handlers)")])),_:1})])])]),a("li",null,[p(n,{to:"#playbook中变量的使用"},{default:i(()=>s[15]||(s[15]=[l("Playbook中变量的使用")])),_:1}),a("ul",null,[a("li",null,[p(n,{to:"#_1-变量定义方式"},{default:i(()=>s[16]||(s[16]=[l("1. 变量定义方式")])),_:1})]),a("li",null,[p(n,{to:"#_2-变量使用规则"},{default:i(()=>s[17]||(s[17]=[l("2. 变量使用规则")])),_:1})]),a("li",null,[p(n,{to:"#_3-特殊变量"},{default:i(()=>s[18]||(s[18]=[l("3. 特殊变量")])),_:1})]),a("li",null,[p(n,{to:"#_4-变量作用域"},{default:i(()=>s[19]||(s[19]=[l("4. 变量作用域")])),_:1})])])]),a("li",null,[p(n,{to:"#最佳实践"},{default:i(()=>s[20]||(s[20]=[l("最佳实践")])),_:1})])])]),s[21]||(s[21]=t(`<hr><h2 id="简介" tabindex="-1"><a class="header-anchor" href="#简介"><span>简介</span></a></h2><p>Playbook 是 Ansible 的配置、部署和编排语言。它可以描述您希望远程系统执行的策略，或者是一组步骤的一般性流程。</p><h3 id="与-ad-hoc-的区别" tabindex="-1"><a class="header-anchor" href="#与-ad-hoc-的区别"><span>与 ad-hoc 的区别</span></a></h3><ul><li>Playbook 可持久化使用</li><li>支持更复杂的部署流程</li><li>可重用和共享</li></ul><h2 id="核心元素" tabindex="-1"><a class="header-anchor" href="#核心元素"><span>核心元素</span></a></h2><ol><li><strong>Hosts</strong>：目标主机列表</li><li><strong>Tasks</strong>：任务列表</li><li><strong>Variables</strong>：变量定义</li><li><strong>Templates</strong>：模板文件</li><li><strong>Handlers</strong>：事件触发器</li><li><strong>Tags</strong>：标签选择器</li></ol><h2 id="基本语法" tabindex="-1"><a class="header-anchor" href="#基本语法"><span>基本语法</span></a></h2><h3 id="yaml-规则" tabindex="-1"><a class="header-anchor" href="#yaml-规则"><span>YAML 规则</span></a></h3><ul><li>使用 <code>.yml</code> 或 <code>.yaml</code> 扩展名</li><li>使用 <code>---</code> 开始文档</li><li>使用空格进行缩进</li><li>区分大小写</li><li>使用 <code>#</code> 注释</li></ul><h2 id="使用示例" tabindex="-1"><a class="header-anchor" href="#使用示例"><span>使用示例</span></a></h2><h3 id="_1-基本示例" tabindex="-1"><a class="header-anchor" href="#_1-基本示例"><span>1. 基本示例</span></a></h3><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">cat</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">playbook01.yml</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;&lt;</span><span class="space"> </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">EOF</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">---</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">#固定格式</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">-</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">hosts:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">192.168.1.31</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">#定义需要执行主机</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">remote_user:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">root</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">#远程用户</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">vars:</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">#定义变量</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">http_port:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">8088</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">#变量</span></span>
<span class="line"></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">tasks:</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">#定义一个任务的开始</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">-</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">name:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">create</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">new</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">file</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">#定义任务的名称</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">file:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">name=/tmp/playtest.txt</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">state=touch</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">#调用模块，具体要做的事情</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">-</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">name:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">create</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">new</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">user</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">user:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">name=test02</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">system=yes</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">shell=/sbin/nologin</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">-</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">name:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">install</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">package</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">yum:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">name=httpd</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">-</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">name:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">config</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">httpd</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">template:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">src=./httpd.conf</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">dest=/etc/httpd/conf/httpd.conf</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">notify:</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">#定义执行一个动作(action)让handlers来引用执行，与handlers配合使用</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">-</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">restart</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">apache</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">#notify要执行的动作，这里必须与handlers中的name定义内容一致</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">-</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">name:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">copy</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">index.html</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">copy:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">src=/var/www/html/index.html</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">dest=/var/www/html/index.html</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">-</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">name:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">start</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">httpd</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">service:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">name=httpd</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">state=started</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">handlers:</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">#处理器：更加tasks中notify定义的action触发执行相应的处理动作</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">-</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">name:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">restart</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">apache</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">#要与notify定义的内容相同</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">service:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">name=httpd</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">state=restarted</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">#触发要执行的动作</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>测试页面准备</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">echo</span><span class="space"> </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&lt;h1&gt;playbook</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">test</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">file&lt;/h1&gt;</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;&gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/var/www/html/index.html</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>配置文件准备</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">cat</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">httpd.conf</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">|</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">grep</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">^Listen</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Listen</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{{ http_port }}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>执行playbook， 第一次执行可以加-C选项，检查写的playbook是否ok</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ansible-playbook</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">playbook01.yml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>验证上面playbook执行的结果</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ansible</span><span class="space"> </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">192.168.1.31</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-m</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">shell</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-a</span><span class="space"> </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">ls</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/tmp/playtest.txt</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&amp;&amp;</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">id</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">test02</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">192.168.1.31</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">|</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">CHANGED</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">|</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">rc=0</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">&gt;&gt;</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">/tmp/playtest.txt</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">uid=990(test02)</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">gid=985(test02)</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">组=985(test02)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">curl</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">192.168.1.31:8088</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">&lt;h1&gt;playbook</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">test</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">file&lt;/h1&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h2 id="playbook的运行方式" tabindex="-1"><a class="header-anchor" href="#playbook的运行方式"><span>Playbook的运行方式</span></a></h2><h3 id="基本用法" tabindex="-1"><a class="header-anchor" href="#基本用法"><span>基本用法</span></a></h3><p>使用 <code>ansible-playbook</code> 命令运行 playbook 文件:</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">基本格式</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ansible-playbook</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">playbook.yml</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">[options]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">检查语法</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ansible-playbook</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">playbook.yml</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">--syntax-check</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">测试运行(不实际执行)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ansible-playbook</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">playbook.yml</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">--check</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">列出受影响的主机</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ansible-playbook</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">playbook.yml</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">--list-hosts</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">列出所有可用的</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">tags</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ansible-playbook</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">playbook.yml</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">--list-tags</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">列出所有任务</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ansible-playbook</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">playbook.yml</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">--list-tasks</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">限制运行的主机</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ansible-playbook</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">playbook.yml</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">--limit</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">web1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">设置并发数(默认5)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ansible-playbook</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">playbook.yml</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-f</span><span class="space"> </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">10</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">运行带有</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">deploy</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">标签的任务</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ansible-playbook</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">playbook.yml</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-t</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">deploy</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">显示详细输出</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ansible-playbook</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">playbook.yml</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-vvv</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="常用选项" tabindex="-1"><a class="header-anchor" href="#常用选项"><span>常用选项</span></a></h3><table><thead><tr><th>选项</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>--check, -C</td><td>测试模式,不实际执行</td><td>ansible-playbook play.yml -C</td></tr><tr><td>--list-hosts</td><td>显示将要运行的主机列表</td><td>ansible-playbook play.yml --list-hosts</td></tr><tr><td>--list-tags</td><td>列出所有可用的 tags</td><td>ansible-playbook play.yml --list-tags</td></tr><tr><td>--list-tasks</td><td>列出所有任务</td><td>ansible-playbook play.yml --list-tasks</td></tr><tr><td>--limit</td><td>限制运行的主机</td><td>ansible-playbook play.yml --limit web1</td></tr><tr><td>-f N</td><td>设置并发数(默认5)</td><td>ansible-playbook play.yml -f 10</td></tr><tr><td>-t TAGS</td><td>只运行指定 tag 的任务</td><td>ansible-playbook play.yml -t deploy</td></tr><tr><td>-v[vv]</td><td>显示详细输出</td><td>ansible-playbook play.yml -vvv</td></tr></tbody></table><h3 id="执行示例" tabindex="-1"><a class="header-anchor" href="#执行示例"><span>执行示例</span></a></h3><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">测试运行</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">playbook</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ansible-playbook</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">site.yml</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">--check</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">只在</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">web</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">组运行</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ansible-playbook</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">site.yml</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">--limit</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">web</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">运行带有</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">deploy</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">标签的任务</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ansible-playbook</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">site.yml</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-t</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">deploy</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">显示详细输出</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ansible-playbook</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">site.yml</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-vvv</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="playbook中元素属性" tabindex="-1"><a class="header-anchor" href="#playbook中元素属性"><span>Playbook中元素属性</span></a></h2><h3 id="_1-主机与用户-hosts-users" tabindex="-1"><a class="header-anchor" href="#_1-主机与用户-hosts-users"><span>1. 主机与用户(Hosts &amp; Users)</span></a></h3><p>定义要操作的目标主机和执行用户:</p><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">基本格式</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">---</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">hosts</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">192.168.1.31</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">remote_user</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">root</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">指定多个主机/组</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">hosts</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">webservers:dbservers</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">remote_user</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">deploy</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="任务级别用户" tabindex="-1"><a class="header-anchor" href="#任务级别用户"><span>任务级别用户</span></a></h4><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">tasks</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">run</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">df</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">-h</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">remote_user</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">test</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">shell</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">name=df</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">-h</span></span>
<span class="line"></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">使用</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">sudo</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">install</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">package</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">sudo</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">yes</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">sudo_user</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">admin</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">yum</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">name=httpd</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">state=present</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-任务列表-tasks" tabindex="-1"><a class="header-anchor" href="#_2-任务列表-tasks"><span>2. 任务列表(Tasks)</span></a></h3><p>每个任务都应该:</p><ul><li>有描述性的名称</li><li>指定要使用的模块</li><li>提供必要的参数</li></ul><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">tasks</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">create</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">new</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">file</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">file</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">path=/tmp/test01.txt</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">state=touch</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">create</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">new</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">user</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">user</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">name=test001</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">state=present</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-处理器-handlers" tabindex="-1"><a class="header-anchor" href="#_3-处理器-handlers"><span>3. 处理器(Handlers)</span></a></h3><p>Handlers 用于响应变更通知:</p><ul><li>httpd.yml</li></ul><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">tasks</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">配置</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Apache</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">template</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">src</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">httpd.conf.j2</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">dest</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/etc/httpd/conf/httpd.conf</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">notify</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">restart</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">apache</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">通知处理器</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">handlers</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">restart</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">apache</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">处理器名称</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">service</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">httpd</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">state</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">restarted</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>注意：</strong></p><ul><li>handlers 只在被通知时执行</li><li>多次通知只执行一次</li><li>按照定义顺序执行</li></ul></blockquote><h2 id="playbook中变量的使用" tabindex="-1"><a class="header-anchor" href="#playbook中变量的使用"><span>Playbook中变量的使用</span></a></h2><h3 id="_1-变量定义方式" tabindex="-1"><a class="header-anchor" href="#_1-变量定义方式"><span>1. 变量定义方式</span></a></h3><h4 id="命令行变量" tabindex="-1"><a class="header-anchor" href="#命令行变量"><span>命令行变量</span></a></h4><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">单个变量</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ansible-playbook</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">test.yml</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-e</span><span class="space"> </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">version=1.0.0</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">多个变量</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ansible-playbook</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">test.yml</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-e</span><span class="space"> </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">hosts=web</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">user=test</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">使用变量文件</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ansible-playbook</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">test.yml</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-e</span><span class="space"> </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">@vars.yml</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="playbook-变量" tabindex="-1"><a class="header-anchor" href="#playbook-变量"><span>Playbook 变量</span></a></h4><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">---</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">hosts</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">webservers</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">vars</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">http_port</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">80</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">max_clients</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">200</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">app_version</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">1.0.0</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">tasks</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">配置</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Apache</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">template</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">src</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">httpd.conf.j2</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">dest</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/etc/httpd/conf/httpd.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="变量文件" tabindex="-1"><a class="header-anchor" href="#变量文件"><span>变量文件</span></a></h4><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">vars/main.yml</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">---</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">db_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">myapp</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">db_user</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">admin</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">db_password</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">secret</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">playbook.yml</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">---</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">hosts</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">dbservers</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">vars_files</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">vars/main.yml</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">tasks</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">创建数据库</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">mysql_db</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{{ db_name }}</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">state</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">present</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-变量使用规则" tabindex="-1"><a class="header-anchor" href="#_2-变量使用规则"><span>2. 变量使用规则</span></a></h3><ul><li>变量名只能包含字母、数字和下划线</li><li>变量名必须以字母开头</li><li>在模板中使用变量需要加双花括号 <code>{{ var_name }}</code></li><li>命令行变量优先级最高</li></ul><h3 id="_3-特殊变量" tabindex="-1"><a class="header-anchor" href="#_3-特殊变量"><span>3. 特殊变量</span></a></h3><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">内置变量</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">ansible_hostname</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">主机名</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">ansible_distribution</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">操作系统</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">ansible_os_family</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">系统家族</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">ansible_architecture</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">系统架构</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">注册变量</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">tasks</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">检查服务状态</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">command</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">systemctl</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">status</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">httpd</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">register</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">service_status</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">显示状态</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">debug</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">var</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">service_status.stdout</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-变量作用域" tabindex="-1"><a class="header-anchor" href="#_4-变量作用域"><span>4. 变量作用域</span></a></h3><ul><li><strong>全局变量</strong>: 适用于所有主机</li><li><strong>主机变量</strong>: 只适用于特定主机</li><li><strong>组变量</strong>: 适用于特定组的所有主机</li><li><strong>任务变量</strong>: 只在特定任务中有效</li></ul><div class="language-ini line-numbers-mode" data-ext="ini" data-title="ini"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">/etc/ansible/hosts</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">主机变量</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">webservers</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">web1</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">http_port</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">8080</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ansible_ssh_user</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">deploy</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">组变量</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">webservers:vars</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">app_env</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">production</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">max_clients</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">200</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="最佳实践" tabindex="-1"><a class="header-anchor" href="#最佳实践"><span>最佳实践</span></a></h2><ol><li><p><strong>变量管理</strong></p><ul><li>使用有意义的变量名</li><li>集中管理变量文件</li><li>合理使用变量作用域</li></ul></li><li><p><strong>安全建议</strong></p><ul><li>加密敏感变量</li><li>避免明文密码</li><li>使用 vault 加密文件</li></ul></li></ol><blockquote><p><strong>注意：</strong></p><ul><li>注意变量优先级</li><li>避免变量名冲突</li><li>谨慎使用全局变量</li></ul></blockquote><hr><blockquote><p><strong>参考资料：</strong></p><ul><li><a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.html" target="_blank" rel="noopener noreferrer">Ansible 变量指南</a></li><li><a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html" target="_blank" rel="noopener noreferrer">最佳实践</a></li></ul></blockquote>`,57))])}const o=e(d,[["render",y],["__file","index.html.vue"]]),v=JSON.parse('{"path":"/linux/88y700au/","title":"Playbook: 介绍","lang":"zh-CN","frontmatter":{"createTime":"2025/02/17 16:59:04","permalink":"/linux/88y700au/","title":"Playbook: 介绍","description":"简介 Playbook 是 Ansible 的配置、部署和编排语言。它可以描述您希望远程系统执行的策略，或者是一组步骤的一般性流程。 与 ad-hoc 的区别 Playbook 可持久化使用 支持更复杂的部署流程 可重用和共享 核心元素 Hosts：目标主机列表 Tasks：任务列表 Variables：变量定义 Templates：模板文件 Hand...","head":[["meta",{"property":"og:url","content":"https://notes.moniter.top/linux/88y700au/"}],["meta",{"property":"og:site_name","content":"Richie Lin"}],["meta",{"property":"og:title","content":"Playbook: 介绍"}],["meta",{"property":"og:description","content":"简介 Playbook 是 Ansible 的配置、部署和编排语言。它可以描述您希望远程系统执行的策略，或者是一组步骤的一般性流程。 与 ad-hoc 的区别 Playbook 可持久化使用 支持更复杂的部署流程 可重用和共享 核心元素 Hosts：目标主机列表 Tasks：任务列表 Variables：变量定义 Templates：模板文件 Hand..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Playbook: 介绍\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"]]},"headers":[],"git":{},"autoDesc":true,"filePathRelative":"notes/linux/Ansible/Playbook-1.md"}');export{o as comp,v as data};
