import{_ as l,c as p,a as i,b as d,d as t,w as n,r as h,o as r,e}from"./app-BVpc6fz1.js";const k={},c={class:"table-of-contents"};function o(y,s){const a=h("router-link");return r(),p("div",null,[i("nav",c,[i("ul",null,[i("li",null,[t(a,{to:"#服务文件详解"},{default:n(()=>s[0]||(s[0]=[e("服务文件详解")])),_:1}),i("ul",null,[i("li",null,[t(a,{to:"#文件位置"},{default:n(()=>s[1]||(s[1]=[e("文件位置")])),_:1})]),i("li",null,[t(a,{to:"#配置文件结构"},{default:n(()=>s[2]||(s[2]=[e("配置文件结构")])),_:1})]),i("li",null,[t(a,{to:"#unit部分"},{default:n(()=>s[3]||(s[3]=[e("Unit部分")])),_:1})]),i("li",null,[t(a,{to:"#service部分"},{default:n(()=>s[4]||(s[4]=[e("Service部分")])),_:1})]),i("li",null,[t(a,{to:"#install部分"},{default:n(()=>s[5]||(s[5]=[e("Install部分")])),_:1})])])]),i("li",null,[t(a,{to:"#完整示例"},{default:n(()=>s[6]||(s[6]=[e("完整示例")])),_:1})])])]),s[7]||(s[7]=d(`<hr><h2 id="服务文件详解" tabindex="-1"><a class="header-anchor" href="#服务文件详解"><span>服务文件详解</span></a></h2><h3 id="文件位置" tabindex="-1"><a class="header-anchor" href="#文件位置"><span>文件位置</span></a></h3><ul><li>系统服务目录: <code>/usr/lib/systemd/system/xxx.service</code></li><li>用户服务目录: <code>/etc/systemd/system/xxx.service</code></li></ul><h3 id="配置文件结构" tabindex="-1"><a class="header-anchor" href="#配置文件结构"><span>配置文件结构</span></a></h3><p>服务文件由三个主要部分组成:</p><ol><li><p><strong>[Unit]</strong> 部分</p><ul><li>定义服务的描述、依赖和顺序</li></ul></li><li><p><strong>[Service]</strong> 部分</p><ul><li>定义服务的具体行为</li></ul></li><li><p><strong>[Install]</strong> 部分</p><ul><li>定义服务的启用/禁用配置</li></ul></li></ol><h3 id="unit部分" tabindex="-1"><a class="header-anchor" href="#unit部分"><span>Unit部分</span></a></h3><p>常用选项：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>Description</td><td>服务描述信息</td></tr><tr><td>After</td><td>在指定服务之后启动</td></tr><tr><td>Before</td><td>在指定服务之前启动</td></tr><tr><td>Requires</td><td>强依赖关系，依赖服务必须启动</td></tr><tr><td>Wants</td><td>弱依赖关系，依赖服务启动失败不影响本服务</td></tr><tr><td>Conflicts</td><td>冲突服务，不能同时运行</td></tr><tr><td>Documentation</td><td>文档地址</td></tr><tr><td>Condition*</td><td>启动条件</td></tr></tbody></table><h3 id="service部分" tabindex="-1"><a class="header-anchor" href="#service部分"><span>Service部分</span></a></h3><p>常用选项：</p><h4 id="type-类型" tabindex="-1"><a class="header-anchor" href="#type-类型"><span>Type 类型</span></a></h4><table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>simple</td><td>默认类型，主进程由 ExecStart 启动</td></tr><tr><td>forking</td><td>服务会调用 fork() 创建子进程</td></tr><tr><td>oneshot</td><td>一次性执行，执行完就退出</td></tr><tr><td>dbus</td><td>通过 D-Bus 启动</td></tr><tr><td>notify</td><td>启动完成后发送通知</td></tr><tr><td>idle</td><td>等待其他任务完成后才启动</td></tr></tbody></table><h4 id="进程控制" tabindex="-1"><a class="header-anchor" href="#进程控制"><span>进程控制</span></a></h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>User</td><td>运行服务的用户</td></tr><tr><td>Group</td><td>运行服务的用户组</td></tr><tr><td>WorkingDirectory</td><td>工作目录</td></tr><tr><td>RootDirectory</td><td>根目录</td></tr><tr><td>Nice</td><td>进程优先级</td></tr><tr><td>OOMScoreAdjust</td><td>OOM优先级</td></tr></tbody></table><h4 id="执行相关" tabindex="-1"><a class="header-anchor" href="#执行相关"><span>执行相关</span></a></h4><div class="language-ini line-numbers-mode" data-ext="ini" data-title="ini"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Service</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">环境配置文件</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">EnvironmentFile</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/etc/sysconfig/myapp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">启动命令</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ExecStart</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/usr/bin/myapp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">启动前执行</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ExecStartPre</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/usr/bin/pre-start.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">启动后执行</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ExecStartPost</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/usr/bin/post-start.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">停止命令</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ExecStop</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/usr/bin/stop.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">服务异常退出时自动重启</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Restart</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">always</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">重启间隔</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RestartSec</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">30</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="特殊标记说明" tabindex="-1"><a class="header-anchor" href="#特殊标记说明"><span>特殊标记说明</span></a></h4><p>ExecStart 命令前的特殊标记:</p><table><thead><tr><th>标记</th><th>说明</th></tr></thead><tbody><tr><td>@</td><td>参数作为一个整体传递</td></tr><tr><td>-</td><td>忽略命令失败</td></tr><tr><td>+</td><td>进程获得特权</td></tr></tbody></table><h3 id="install部分" tabindex="-1"><a class="header-anchor" href="#install部分"><span>Install部分</span></a></h3><p>常用选项：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>Alias</td><td>服务别名</td></tr><tr><td>RequiredBy</td><td>被其他服务强依赖</td></tr><tr><td>WantedBy</td><td>被其他服务弱依赖</td></tr><tr><td>Also</td><td>同时安装的其他服务</td></tr><tr><td>DefaultInstance</td><td>实例默认名称</td></tr></tbody></table><h2 id="完整示例" tabindex="-1"><a class="header-anchor" href="#完整示例"><span>完整示例</span></a></h2><div class="language-ini line-numbers-mode" data-ext="ini" data-title="ini"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Unit</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Description</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">My</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Application</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Service</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">After</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">network.target</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Requires</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">mysql.service</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Documentation</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">https://example.com/docs</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Service</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Type</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">simple</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">User</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">myapp</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Group</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">myapp</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">WorkingDirectory</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/opt/myapp</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">EnvironmentFile</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/etc/sysconfig/myapp</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ExecStartPre</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/usr/bin/pre-start.sh</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ExecStart</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/usr/bin/myapp</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ExecStop</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/usr/bin/stop.sh</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Restart</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">always</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RestartSec</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">30</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Nice</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">-5</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Install</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">WantedBy</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">multi-user.target</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Alias</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">myapp.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>注意：</strong></p><ul><li><p>修改服务文件后需要重新加载:</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">daemon-reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>路径必须使用绝对路径</p></li><li><p>Type=forking 时建议设置 PIDFile</p></li><li><p>注意设置合适的用户权限</p></li><li><p>建议添加文档链接</p></li></ul></blockquote>`,27))])}const g=l(k,[["render",o],["__file","index.html.vue"]]),v=JSON.parse('{"path":"/linux/0p3b57if/","title":"系统服务启动文件","lang":"zh-CN","frontmatter":{"createTime":"2025/02/17 16:59:04","permalink":"/linux/0p3b57if/","title":"系统服务启动文件","description":"服务文件详解 文件位置 系统服务目录: /usr/lib/systemd/system/xxx.service 用户服务目录: /etc/systemd/system/xxx.service 配置文件结构 服务文件由三个主要部分组成: [Unit] 部分 定义服务的描述、依赖和顺序 [Service] 部分 定义服务的具体行为 [Install] 部分...","head":[["meta",{"property":"og:url","content":"https://notes.moniter.top/linux/0p3b57if/"}],["meta",{"property":"og:site_name","content":"Richie Lin"}],["meta",{"property":"og:title","content":"系统服务启动文件"}],["meta",{"property":"og:description","content":"服务文件详解 文件位置 系统服务目录: /usr/lib/systemd/system/xxx.service 用户服务目录: /etc/systemd/system/xxx.service 配置文件结构 服务文件由三个主要部分组成: [Unit] 部分 定义服务的描述、依赖和顺序 [Service] 部分 定义服务的具体行为 [Install] 部分..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"系统服务启动文件\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"]]},"headers":[],"git":{},"autoDesc":true,"filePathRelative":"notes/linux/Systemd/2.系统服务启动文件.md"}');export{g as comp,v as data};
