import{_ as e,c as t,a,b as h,d as n,w as l,r as k,o as r,e as p}from"./app-BVpc6fz1.js";const c={},d={class:"table-of-contents"};function A(o,s){const i=k("router-link");return r(),t("div",null,[a("nav",d,[a("ul",null,[a("li",null,[n(i,{to:"#什么是防火墙"},{default:l(()=>s[0]||(s[0]=[p("什么是防火墙")])),_:1}),a("ul",null,[a("li",null,[n(i,{to:"#防火墙分类"},{default:l(()=>s[1]||(s[1]=[p("防火墙分类")])),_:1})]),a("li",null,[n(i,{to:"#iptables的工作原理"},{default:l(()=>s[2]||(s[2]=[p("iptables的工作原理")])),_:1})]),a("li",null,[n(i,{to:"#netfilter-钩子点"},{default:l(()=>s[3]||(s[3]=[p("netfilter 钩子点")])),_:1})]),a("li",null,[n(i,{to:"#表和链"},{default:l(()=>s[4]||(s[4]=[p("表和链")])),_:1})]),a("li",null,[n(i,{to:"#防火墙策略"},{default:l(()=>s[5]||(s[5]=[p("防火墙策略")])),_:1})])])]),a("li",null,[n(i,{to:"#常用命令示例"},{default:l(()=>s[6]||(s[6]=[p("常用命令示例")])),_:1}),a("ul",null,[a("li",null,[n(i,{to:"#基本防护配置"},{default:l(()=>s[7]||(s[7]=[p("基本防护配置")])),_:1})]),a("li",null,[n(i,{to:"#服务访问控制"},{default:l(()=>s[8]||(s[8]=[p("服务访问控制")])),_:1})]),a("li",null,[n(i,{to:"#防止-ddos-攻击"},{default:l(()=>s[9]||(s[9]=[p("防止 DDoS 攻击")])),_:1})]),a("li",null,[n(i,{to:"#保存和恢复规则"},{default:l(()=>s[10]||(s[10]=[p("保存和恢复规则")])),_:1})])])])])]),s[11]||(s[11]=h(`<hr><h2 id="什么是防火墙" tabindex="-1"><a class="header-anchor" href="#什么是防火墙"><span>什么是防火墙</span></a></h2><p>防火墙是一种网络安全设备，用于控制和监控网络流量。主要分为：</p><ul><li><strong>硬件防火墙</strong>: 专用硬件设备</li><li><strong>软件防火墙</strong>: 如 Linux 的 iptables</li></ul><h3 id="防火墙分类" tabindex="-1"><a class="header-anchor" href="#防火墙分类"><span>防火墙分类</span></a></h3><ol><li><p><strong>网络层防火墙 (L3/L4)</strong></p><ul><li>工作在 OSI 第 3/4 层</li><li>主要检查源/目标地址和端口</li><li>处理速度快，适合大流量环境</li></ul></li><li><p><strong>应用层防火墙 (L7)</strong></p><ul><li>工作在 OSI 第 7 层</li><li>可以理解应用层协议</li><li>提供更细粒度的控制</li><li>处理速度相对较慢</li></ul></li></ol><h3 id="iptables的工作原理" tabindex="-1"><a class="header-anchor" href="#iptables的工作原理"><span>iptables的工作原理</span></a></h3><p>iptables 是 Linux 系统中的包过滤防火墙，具有以下特点：</p><ul><li>基于 netfilter 框架</li><li>支持状态检测</li><li>可扩展的规则系统</li><li>支持 NAT 和数据包修改</li></ul><h3 id="netfilter-钩子点" tabindex="-1"><a class="header-anchor" href="#netfilter-钩子点"><span>netfilter 钩子点</span></a></h3><p>netfilter 在内核中提供了 5 个钩子点：</p><ol><li><strong>PREROUTING</strong>: 数据包进入路由表之前</li><li><strong>INPUT</strong>: 数据包流入本地进程</li><li><strong>FORWARD</strong>: 数据包需要转发时</li><li><strong>OUTPUT</strong>: 本地进程发出的数据包</li><li><strong>POSTROUTING</strong>: 数据包离开路由表之后</li></ol><h3 id="表和链" tabindex="-1"><a class="header-anchor" href="#表和链"><span>表和链</span></a></h3><p>iptables 使用&quot;表&quot;来组织规则，每个表包含多个&quot;链&quot;：</p><h4 id="表的类型" tabindex="-1"><a class="header-anchor" href="#表的类型"><span>表的类型</span></a></h4><ol><li><strong>filter 表</strong>: 默认表，负责过滤</li><li><strong>nat 表</strong>: 网络地址转换</li><li><strong>mangle 表</strong>: 数据包修改</li><li><strong>raw 表</strong>: 连接跟踪豁免</li></ol><h4 id="规则匹配顺序" tabindex="-1"><a class="header-anchor" href="#规则匹配顺序"><span>规则匹配顺序</span></a></h4><ol><li>表的处理顺序：raw -&gt; mangle -&gt; nat -&gt; filter</li><li>链内规则从上到下依次匹配</li><li>找到匹配规则后执行动作，除非指定继续</li></ol><h3 id="防火墙策略" tabindex="-1"><a class="header-anchor" href="#防火墙策略"><span>防火墙策略</span></a></h3><p>iptables 支持两种基本策略：</p><ul><li><strong>DROP</strong>: 默认拒绝（白名单模式）</li><li><strong>ACCEPT</strong>: 默认允许（黑名单模式）</li></ul><h2 id="常用命令示例" tabindex="-1"><a class="header-anchor" href="#常用命令示例"><span>常用命令示例</span></a></h2><h3 id="基本防护配置" tabindex="-1"><a class="header-anchor" href="#基本防护配置"><span>基本防护配置</span></a></h3><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">清空现有规则</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">iptables</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-F</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">设置默认策略</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">iptables</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-P</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">INPUT</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">DROP</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">iptables</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-P</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">FORWARD</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">DROP</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">iptables</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-P</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">OUTPUT</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">ACCEPT</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">允许已建立的连接</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">iptables</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-A</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">INPUT</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-m</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">state</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">--state</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">ESTABLISHED,RELATED</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-j</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">ACCEPT</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">允许本地回环</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">iptables</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-A</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">INPUT</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-i</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">lo</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-j</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">ACCEPT</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="服务访问控制" tabindex="-1"><a class="header-anchor" href="#服务访问控制"><span>服务访问控制</span></a></h3><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">允许</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">SSH</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">访问</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">iptables</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-A</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">INPUT</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-p</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">tcp</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">--dport</span><span class="space"> </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">22</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-j</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">ACCEPT</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">允许</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">Web</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">服务</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">iptables</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-A</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">INPUT</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-p</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">tcp</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">--dport</span><span class="space"> </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">80</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-j</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">ACCEPT</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">iptables</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-A</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">INPUT</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-p</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">tcp</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">--dport</span><span class="space"> </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">443</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-j</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">ACCEPT</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="防止-ddos-攻击" tabindex="-1"><a class="header-anchor" href="#防止-ddos-攻击"><span>防止 DDoS 攻击</span></a></h3><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">限制单</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">IP</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">并发连接数</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">iptables</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-A</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">INPUT</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-p</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">tcp</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">--syn</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-m</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">connlimit</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">--connlimit-above</span><span class="space"> </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">15</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-j</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">DROP</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">限制连接速率</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">iptables</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-A</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">INPUT</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-p</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">tcp</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">--dport</span><span class="space"> </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">80</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-m</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">limit</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">--limit</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">25/minute</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">--limit-burst</span><span class="space"> </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">100</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-j</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">ACCEPT</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="保存和恢复规则" tabindex="-1"><a class="header-anchor" href="#保存和恢复规则"><span>保存和恢复规则</span></a></h3><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">保存规则</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">iptables-save</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/etc/iptables/rules.v4</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">恢复规则</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">iptables-restore</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/etc/iptables/rules.v4</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>最佳实践：</strong></p><ul><li>始终备份当前规则</li><li>先测试后应用</li><li>保留远程管理访问</li><li>定期审计规则</li></ul></blockquote>`,31))])}const y=e(c,[["render",A],["__file","index.html.vue"]]),u=JSON.parse('{"path":"/linux/egqb1n00/","title":"Iptable: 防火墙","lang":"zh-CN","frontmatter":{"createTime":"2025/02/17 16:59:04","permalink":"/linux/egqb1n00/","title":"Iptable: 防火墙","description":"什么是防火墙 防火墙是一种网络安全设备，用于控制和监控网络流量。主要分为： 硬件防火墙: 专用硬件设备 软件防火墙: 如 Linux 的 iptables 防火墙分类 网络层防火墙 (L3/L4) 工作在 OSI 第 3/4 层 主要检查源/目标地址和端口 处理速度快，适合大流量环境 应用层防火墙 (L7) 工作在 OSI 第 7 层 可以理解应用层协...","head":[["meta",{"property":"og:url","content":"https://notes.moniter.top/linux/egqb1n00/"}],["meta",{"property":"og:site_name","content":"Richie Lin"}],["meta",{"property":"og:title","content":"Iptable: 防火墙"}],["meta",{"property":"og:description","content":"什么是防火墙 防火墙是一种网络安全设备，用于控制和监控网络流量。主要分为： 硬件防火墙: 专用硬件设备 软件防火墙: 如 Linux 的 iptables 防火墙分类 网络层防火墙 (L3/L4) 工作在 OSI 第 3/4 层 主要检查源/目标地址和端口 处理速度快，适合大流量环境 应用层防火墙 (L7) 工作在 OSI 第 7 层 可以理解应用层协..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Iptable: 防火墙\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"]]},"headers":[],"git":{},"autoDesc":true,"filePathRelative":"notes/linux/Iptable/IptableInfo.md"}');export{y as comp,u as data};
